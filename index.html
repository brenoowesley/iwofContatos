<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Central de Contatos de Suporte</title>
    <!-- Carrega o Tailwind CSS para estilos r√°pidos -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Importa a fonte 'Inter', que √© limpa e moderna -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            /* Cor de fundo padr√£o */
            background-image: url('https://imgur.com/f9IqFb4.jpg');
            /* ESTA URL SER√Å ATUALIZADA PELA IMAGEM GERADA */
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            /* Mant√©m a imagem fixa ao rolar */
            display: flex;
            /* Para centralizar o conte√∫do verticalmente */
            align-items: center;
            /* Centraliza verticalmente */
            justify-content: center;
            /* Centraliza horizontalmente */
            min-height: 100vh;
            /* Garante que o body ocupe a altura total da viewport */
            position: relative;
            /* Necess√°rio para o overlay */
        }

        /* Overlay para escurecer/emba√ßar ainda mais o fundo e garantir legibilidade */
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(26, 0, 10, 0.7);
            /* Branco semi-transparente para o blur */
            backdrop-filter: blur(8px);
            /* Aplica o blur no overlay */
            z-index: -1;
            /* Fica abaixo do conte√∫do principal */
        }

        /* Cores da marca iWof */
        .text-iwof-pink {
            color: #E8368F;
            /* Cor rosa da Image 2 */
        }

        .bg-iwof-pink {
            background-color: #E8368F;
        }

        .bg-iwof-pink:hover {
            background-color: #d12e80;
            /* Um tom mais escuro para o hover */
        }

        .border-iwof-pink {
            border-color: #E8368F;
        }

        /* Cor azul escura da logo */
        .bg-iwof-darkblue {
            background-color: #004a91;
            /* Cor da Image 1 */
        }

        .text-iwof-darkblue {
            color: #004a91;
        }

        /* Estilos para o √≠cone do WhatsApp */
        .whatsapp-icon {
            filter: brightness(0) invert(1);
            /* Torna o √≠cone branco para contrastar com o fundo */
        }
    </style>
</head>

<body class="p-4">

    <div class="w-full max-w-lg mx-auto bg-white p-6 md:p-8 rounded-xl shadow-2xl relative z-10">

        <!-- Cabe√ßalho com logo e t√≠tulo -->
        <header class="text-center mb-8">
            <!-- Logo fornecida pelo usu√°rio --><img src="https://imgur.com/a/mekhc74.jpg" alt="Logo iWof"
                class="h-16 mx-auto mb-4" onerror="this.style.display='none'">
            <h1 class="text-3xl font-bold text-gray-800">Fale com o DinDin</h1>
            <p class="text-gray-600 mt-1">Precisa de ajuda? Clique em um dos contatos ativos abaixo para falar conosco.
            </p>
        </header>

        <!-- Mensagem de Erro/Instru√ß√£o -->
        <div id="error-message"
            class="hidden bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 mb-6 rounded-md shadow-sm">
            <p class="font-bold">Aten√ß√£o!</p>
            <p>N√£o foi poss√≠vel carregar os dados da planilha. Por favor, certifique-se de que voc√™ publicou a planilha
                corretamente.</p>
            <p class="mt-2 text-sm">Instru√ß√µes: Abra a planilha, v√° em <code
                    class="bg-gray-200 p-1 rounded">Arquivo</code> > <code
                    class="bg-gray-200 p-1 rounded">Compartilhar</code> > <code
                    class="bg-gray-200 p-1 rounded">Publicar na web</code> e publique como <code
                    class="bg-gray-200 p-1 rounded">Valores separados por v√≠rgula (.csv)</code>.</p>
        </div>

        <!-- Indicador de Carregamento -->
        <div id="loading" class="flex justify-center items-center py-10 text-iwof-darkblue">
            <svg class="animate-spin h-8 w-8 text-iwof-darkblue" xmlns="http://www.w3.org/2000/svg" fill="none"
                viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor"
                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                </path>
            </svg>
            <span class="ml-3 text-gray-700 font-semibold">Carregando contatos...</span>
        </div>

        <!-- Container para os links (cards) -->
        <main id="link-container" class="space-y-4">
            <!-- Os cards de contato ser√£o injetados aqui pelo JavaScript -->
        </main>

        <!-- Rodap√© -->
        <footer class="text-center mt-8 text-gray-500 text-sm">
            <p>&copy; <span id="current-year"></span> iWof. Todos os direitos reservados.</p>
        </footer>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Nova URL da planilha publicada
            const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vT2y56LkAI0gPlnI8b6Y9m2v0BS3nLGFeVLwimOUm5cuS-gMaa7HsxGGrezgyWPgtaJskbS1kgJvw-K/pub?output=csv';

            // URL do Web App de tracking (Google Apps Script)
            const TRACKING_API_URL = 'https://script.google.com/macros/s/AKfycbxfXIz4NzrP1KOfWeIccpsumupUypNy7wvN20LM0_j3ruoSAERp98dR_9WJ55K9oQGg/exec';

            // Refer√™ncias aos elementos do DOM
            const linkContainer = document.getElementById('link-container');
            const loading = document.getElementById('loading');
            const errorMessage = document.getElementById('error-message');
            document.getElementById('current-year').textContent = new Date().getFullYear();

            // Fun√ß√£o para registrar o clique no link
            function trackClick(linkName) {
                console.log('üîπ Tracking clique:', linkName);
                // Usa Image beacon (GET request) para evitar problemas de CORS
                const params = new URLSearchParams({
                    link: linkName,
                    t: Date.now() // Cache buster
                });
                const img = new Image();
                img.src = `${TRACKING_API_URL}?${params.toString()}`;
                console.log('üîπ URL de tracking:', img.src);
            }

            // Dados de exemplo caso a planilha falhe (para design)
            const MOCK_DATA = [
                { contato: '+55 11 99999-9999', nome: 'Suporte Vendas (Ativo)', status: 'ativo', tipo: 'whatsapp' },
                { contato: '+55 11 88888-8888', nome: 'Suporte T√©cnico (Ativo)', status: 'ativo', tipo: 'whatsapp' },
                { contato: 'https://google.com', nome: 'Link Externo (Ativo)', status: 'ativo', tipo: 'link' },
                { contato: '+55 11 77777-7777', nome: 'Contato Geral (Inativo)', status: 'inativo', tipo: 'whatsapp' }
            ];

            // Fun√ß√£o principal para buscar e renderizar os dados
            async function fetchData() {
                loading.classList.remove('hidden');
                errorMessage.classList.add('hidden');

                try {
                    const response = await fetch(CSV_URL);

                    if (!response.ok) {
                        throw new Error('Falha ao buscar CSV. Planilha provavelmente n√£o publicada ou URL incorreta.');
                    }

                    const csvText = await response.text();
                    const data = parseCSV(csvText);
                    renderData(data);

                } catch (error) {
                    console.error("Erro ao carregar dados da planilha:", error);
                    errorMessage.classList.remove('hidden');
                    renderData(MOCK_DATA); // Renderiza dados mockados em caso de erro real
                } finally {
                    loading.classList.add('hidden');
                }
            }

            // Fun√ß√£o para converter o texto CSV em um array de objetos
            function parseCSV(text) {
                const lines = text.split('\n').filter(line => line.trim() !== ''); // Filtra linhas vazias
                if (lines.length === 0) return [];

                // Assume que a primeira linha √© o cabe√ßalho e ignora
                const data = lines.slice(1).map(line => {
                    // Usar um regex para splitar por v√≠rgula, mas ignorar v√≠rgulas dentro de aspas
                    const parts = line.match(/(?:[^,"']+|"[^"]*")+/g);
                    if (!parts || parts.length < 3) return null; // Garante que a linha tem pelo menos 3 colunas

                    const [contato, nome, status, tipo] = parts.map(part => part.replace(/^"|"$/g, '').trim()); // Remove aspas e trim

                    return {
                        contato: contato || '',
                        nome: nome || '',
                        status: status ? status.toLowerCase() : '', // Normaliza o status
                        tipo: tipo ? tipo.toLowerCase() : 'whatsapp' // Normaliza o tipo, padr√£o whatsapp
                    };
                }).filter(item => item && item.nome && item.status); // Filtra itens nulos ou incompletos

                return data;
            }

            // Fun√ß√£o para renderizar os dados na tela
            function renderData(data) {
                linkContainer.innerHTML = ''; // Limpa o container

                if (data.length === 0) {
                    linkContainer.innerHTML = '<p class="text-center text-gray-500">Nenhum contato encontrado.</p>';
                    return;
                }

                data.forEach(item => {
                    const card = createLinkCard(item);
                    linkContainer.appendChild(card);
                });
            }

            // Fun√ß√£o para criar um card de contato
            function createLinkCard(item) {
                const { nome, contato, status, tipo } = item;
                const isActive = status === 'ativo';
                const isLink = tipo === 'link';

                let href = '#';
                let iconHtml = '';

                if (isActive) {
                    if (isLink) {
                        // Se for link, usa o valor do contato como URL
                        // Adiciona https:// se n√£o tiver protocolo
                        href = contato.match(/^https?:\/\//) ? contato : `https://${contato}`;

                        // √çcone de Link/Formul√°rio (SVG)
                        iconHtml = `
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mr-4 flex-shrink-0 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                            </svg>
                        `;
                    } else {
                        // Comportamento padr√£o (WhatsApp)
                        const waNumber = contato.replace(/\D/g, ''); // Remove caracteres n√£o num√©ricos
                        href = `https://wa.me/${waNumber}`;

                        // √çcone do WhatsApp (Imagem existente)
                        iconHtml = `
                            <img src="https://imgur.com/oR4cu8N.png" 
                                 alt="WhatsApp Icon" 
                                 class="h-8 w-8 mr-4 whatsapp-icon flex-shrink-0">
                        `;
                    }
                }

                const el = document.createElement(isActive ? 'a' : 'div');

                el.className = `flex items-center w-full p-5 rounded-lg shadow-md text-white transition-all duration-300 transform`;

                if (isActive) {
                    el.href = href;
                    el.target = '_blank';
                    el.rel = 'noopener noreferrer';
                    el.classList.add('bg-iwof-pink', 'hover:scale-105', 'hover:shadow-xl');

                    // Adiciona tracking de clique
                    el.addEventListener('click', () => {
                        trackClick(nome);
                    });
                } else {
                    el.classList.add('bg-gray-400', 'opacity-70', 'cursor-not-allowed');
                }

                el.innerHTML = `
                    ${iconHtml}
                    <div class="flex-grow">
                        <div class="font-bold text-lg">${nome}</div>
                    </div>
                    <div class="ml-4 flex-shrink-0">
                        <span class="text-xs font-semibold px-3 py-1 rounded-full ${isActive ? 'bg-green-500' : 'bg-gray-700'}">
                            ${isActive ? 'Ativo' : 'Inativo'}
                        </span>
                    </div>
                `;

                return el;
            }

            fetchData();
        });
    </script>

</body>

</html>